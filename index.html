<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Retkittäin – Retkelle helposti</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body { font-family: Arial, sans-serif; background:#eef3ef; margin:0; }
    .screen { display:none; padding:30px; max-width:1000px; margin:0 auto; background:white; min-height:100vh; box-sizing:border-box; }
    .active { display:block; }
    h1,h2,h3 { color:#2f5d50; }
    button { padding:10px 16px; margin-top:10px; cursor:pointer; background:#2f5d50; color:white; border:none; border-radius:6px; }
    .card { background:#f7faf8; padding:15px; border-radius:8px; margin-top:15px; }
    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:15px; }
    .dest-card { border:1px solid #ddd; border-radius:8px; overflow:hidden; background:white; }
    .dest-card div { padding:10px; }
    #map { height:400px; border-radius:8px; }
    select { padding:6px; margin:5px; }
    .logo { font-size:28px; font-weight:bold; color:#2f5d50; }
    .topbar { display:flex; justify-content:space-between; align-items:center; }
  </style>
</head>
<body>

<div class="screen active" id="screen1">
  <div class="topbar">
    <div class="logo">Retkittäin</div>
  </div>
  <h1>Suunnittele retkesi helposti</h1>
  <p>Valitse retken kesto ja vuodenaika – näet sopivat kohteet ja saat pakkauslistan.</p>
  <button onclick="showScreen(2)">Aloita</button>
</div>

<div id="screen2" class="screen">
  <div class="topbar"><div class="logo">Retkittäin</div></div>
  <h1>Retken tiedot</h1>

  <p>Retken kesto:</p>
  <select id="lengthSelect">
    <option value="paiva">Päiväretki</option>
    <option value="yo">Yön yli</option>
    <option value="pitka">Useampi päivä</option>
  </select>

  <p>Vuodenaika:</p>
  <select id="seasonSelect">
    <option value="kesa">Kesä / sulan maan aika</option>
    <option value="talvi">Talvi</option>
  </select>

  <button onclick="showScreen(3)">Siirry kartalle</button>
</div>

<div id="screen3" class="screen">
  <div class="topbar"><div class="logo">Retkittäin</div></div>
  <h1>Valitse kohde</h1>
  <div id="map"></div>

  <div class="card">
    <strong>Suodatus:</strong><br>
    Retken kesto: <span id="currentLength"></span><br>
    Vuodenaika: <span id="currentSeason"></span>
  </div>

  <div id="destinationResults"></div>
  <button onclick="showScreen(4)">Siirry pakkauslistaan</button>
  <button onclick="showScreen(1)">Aloita alusta</button>
</div>

<div id="screen4" class="screen">
  <div class="topbar"><div class="logo">Retkittäin</div></div>
  <div id="packingList"></div>
  <br>
  <button onclick="printPDF()">Tulosta / Tallenna PDF</button>
  <button onclick="shareLink()">Kopioi jakolinkki</button>
  <button onclick="showScreen(3)">Takaisin karttaan</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// ===== Näyttöjen vaihto =====
function showScreen(n){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById('screen'+n).classList.add('active');
  if(n===3){ initMap(); }
  if(n===4){ initPackingList(); }
}

// ===== Kohdetietokanta =====
const destinations = [
  {name:'Nuuksion kansallispuisto', length:['paiva','yo'], season:['kesa','talvi'], lat:60.32, lon:24.55, link:'https://www.luontoon.fi/nuuksio', desc:'Etelä-Suomen suosituin retkikohde.'},
  {name:'Teijon kansallispuisto', length:['paiva','yo'], season:['kesa','talvi'], lat:60.23, lon:23.30, link:'https://www.luontoon.fi/teijo', desc:'Järviä ja ruukkimiljöötä.'},
  {name:'Kurjenrahkan kansallispuisto', length:['paiva','yo','pitka'], season:['kesa','talvi'], lat:60.72, lon:22.35, link:'https://www.luontoon.fi/kurjenrahka', desc:'Suomaisemaa Varsinais-Suomessa.'},
  {name:'Selkämeren kansallispuisto', length:['paiva','yo'], season:['kesa'], lat:61.2, lon:21.4, link:'https://www.luontoon.fi/selkameri', desc:'Merellisiä retkikohteita.'},
  {name:'Kauhanevan–Nevan kansallispuisto', length:['paiva','yo'], season:['kesa','talvi'], lat:62.2, lon:22.5, link:'https://www.luontoon.fi/kauhaneva', desc:'Aavaa suomaisemaa.'},
  {name:'Kolin kansallispuisto', length:['paiva','yo','pitka'], season:['kesa','talvi'], lat:63.1, lon:29.8, link:'https://www.luontoon.fi/koli', desc:'Suomen ikonisin vaaramaisema.'},
  {name:'Hossan kansallispuisto', length:['paiva','yo','pitka'], season:['kesa','talvi'], lat:64.4, lon:29.3, link:'https://www.luontoon.fi/hossa', desc:'Julma-Ölkyn rotkojärvi.'},
  {name:'Repoveden kansallispuisto', length:['paiva','yo'], season:['kesa','talvi'], lat:61.6, lon:26.5, link:'https://www.luontoon.fi/repovesi', desc:'Jyrkät kalliot ja riippusillat.'},
  {name:'Oulangan kansallispuisto – Karhunkierros', length:['yo','pitka'], season:['kesa','talvi'], lat:66.3, lon:29.3, link:'https://www.luontoon.fi/oulanka', desc:'Suomen tunnetuin vaellusreitti.'},
  {name:'Urho Kekkosen kansallispuisto', length:['pitka'], season:['kesa','talvi'], lat:68.2, lon:27.6, link:'https://www.luontoon.fi/urhokekkonen', desc:'Tuntureita ja erämaata.'}
];

let map;
function initMap(){
  const length = document.getElementById('lengthSelect').value;
  const season = document.getElementById('seasonSelect').value;
  document.getElementById('currentLength').innerText = length;
  document.getElementById('currentSeason').innerText = season;

  if(!map){
    map = L.map('map').setView([64.5, 26.0], 4);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
  }

  map.eachLayer(layer => { if(layer instanceof L.Marker) map.removeLayer(layer); });

  const filtered = destinations.filter(d => d.length.includes(length) && d.season.includes(season));
  let html = '<h2>Sopivat kohteet</h2><div class="grid">';

  filtered.forEach(d => {
    L.marker([d.lat, d.lon]).addTo(map).bindPopup('<b>'+d.name+'</b><br><a href="'+d.link+'" target="_blank">Avaa tiedot</a>');
    html += '<div class="dest-card"><div><h3>'+d.name+'</h3><p>'+d.desc+'</p><a href="'+d.link+'" target="_blank">Avaa kohdetiedot</a></div></div>';
  });

  html += '</div>';
  document.getElementById('destinationResults').innerHTML = html;
}

// ===== Pakkauslista =====
function initPackingList(){
  const length = document.getElementById('lengthSelect').value;
  const season = document.getElementById('seasonSelect').value;
  let html = '<h1>Pakkauslista</h1>';
  html += '<p>Retken kesto: '+length+' | Vuodenaika: '+season+'</p>';

  // Kevyt päiväretkilista kesällä
  if(length==='paiva' && season==='kesa'){
    const dayItems = [
      'Mukavat kengät maastoon',
      'Hengittävä ja muunneltava vaatetus',
      'Taukovaatetus',
      'Sadevaatteet',
      'Reppu',
      'Vesipullo',
      'Ruoat ja ruoanvalmistusvälineet',
      'Kartta',
      'Kompassi',
      'Ensiaputarvikkeet',
      'Puukko',
      'Matkapuhelin + varavirtalähde'
    ];
    html += buildChecklist(dayItems,'day_');
    document.getElementById('packingList').innerHTML = html;
    bindCheckboxes();
    return;
  }

  // Yön yli ja pidemmät vaellukset (kesä / sula maa)
  let fullItems = [
    'Reppu / rinkka',
    'Vedenpitävät kuivasäkit',
    'Vaelluskengät',
    'Shortsit (kesällä)',
    'Hengittävä merinovillainen t-paita + vaihtopaita',
    'Varasukat',
    'Sadetakki ja -housut',
    'Taukovaatetus',
    'Pipo viileämmille keleille',
    'Majoite – teltta tai riippumatto',
    'Riippumaton lisävarusteet (narut, kiinnikkeet, aluspeite)',
    'Makuupussi',
    'Makuualusta',
    'Otsalamppu',
    'Kartta ja kompassi',
    'GPS (valinnainen)',
    'Vaellussauvat (valinnainen)',
    'Ruoka pakattuna päiväannoksiin',
    'Vettä tarpeen mukaan',
    'Vedenpuhdistin tai tabletit',
    'Tulitikkuja vedenpitävässä rasiassa',
    'Katkaistu tiskiharja ja biohajoava pesuaine',
    'Muki ja ruokailuvälineet',
    'Pakkauspussi ruoalle',
    'Ensiaputarvikkeet',
    'Rakkolaastarit',
    'Lääkkeet',
    'Hammasharja ja -tahna',
    'Aurinkorasva ja huulirasva',
    'Vessapaperi vesitiiviissä pussissa',
    'Käsidesi',
    'Pyyhe',
    'Hyttysmyrkky tai hyttyshattu',
    'Puukko',
    'Matkapuhelin + varavirtalähde'
  ];

  // Talvella poistetaan hyttysvarusteet
  if(season==='talvi'){
    fullItems = fullItems.filter(item => !item.toLowerCase().includes('hyttys'));
  }

  html += '<p><em>Voit muokata listaa: lisää tai poista omia varusteita.</em></p>';
  html += '<input id="newItem" placeholder="Lisää oma varuste"> <button onclick="addCustomItem()">Lisää</button>';
  html += buildChecklist(fullItems,'full_');

  document.getElementById('packingList').innerHTML = html;
  bindCheckboxes();
}

function buildChecklist(items,prefix){
  let html = '<div>';
  items.forEach((item,i)=>{
    const key = prefix+i;
    const checked = localStorage.getItem(key)==='true' ? 'checked' : '';
    html += '<div><label><input type="checkbox" data-key="'+key+'" '+checked+'> '+item+'</label></div>';
  });
  html += '</div>';
  return html;
}

function addCustomItem(){
  const input = document.getElementById('newItem');
  if(!input.value) return;
  let custom = JSON.parse(localStorage.getItem('customItems')||'[]');
  custom.push(input.value);
  localStorage.setItem('customItems',JSON.stringify(custom));
  initPackingList();
}

function bindCheckboxes(){
  document.querySelectorAll('input[type=checkbox]').forEach(cb=>{
    cb.addEventListener('change', e=>{
      localStorage.setItem(e.target.dataset.key, e.target.checked);
    });
  });
}

// ===== PDF ja jakaminen =====
function shareLink(){(){
  navigator.clipboard.writeText(window.location.href);
  alert('Linkki kopioitu!');
}
</script>

</body>
</html>
